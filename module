local options
module = {}

module.init = function()
    if getgenv().Settings then
        options = getgenv().Settings
    end
    if not getgenv().Settings then
        options = {["Type"] = "Outlines", ["FillType"] = "Model"}
    end
end

module.AddESP = function(part, color, config, name)
    if part:FindFirstChild("esp") then
        part:FindFirstChild("esp"):Destroy()
    end

    local espObject = Instance.new("Highlight")

    if config["Type"] == "Outlines" then
        espObject.FillTransparency = 1
        espObject.OutlineColor = color
        espObject.Parent = part
        espObject.Name = "esp"
    end

    if config["Type"] == "Fill" then
        if config["FillType"] == "Model" then
            espObject.FillTransparency = 0.5
            espObject.FillColor = color
            espObject.OutlineColor = Color3.fromRGB(255, 255, 255)
            espObject.Parent = part
            espObject.Name = "esp"
        end
        if config["FillType"] == "Limb" then
            for i, v in pairs(part:GetChildren()) do
                if v:isA("BasePart") then
                    local limbs = Instance.new("Highlight")
                    limbs.FillTransparency = 0.5
                    limbs.FillColor = color
                    limbs.OutlineColor = Color3.fromRGB(255, 255, 255)
                    limbs.Parent = v
                    limbs.Name = "esp"
                end
            end
        end
    end

    if config["Type"] == "Names" and name then
        local esp = Instance.new("BillboardGui")
        esp.Adornee = part
        esp.Size = UDim2.new(0, 100, 0, 30)
        esp.StudsOffset = Vector3.new(0, 5, 0)
        esp.Parent = part
        esp.Name = "esp"
    
        local espLabel = Instance.new("TextLabel")
        espLabel.Size = UDim2.new(1, 0, 1, 0)
        espLabel.Text = name
        espLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        espLabel.TextStrokeTransparency = 0.8
        espLabel.BackgroundTransparency = 1
        espLabel.Parent = esp
        espLabel.Name = "esp"
    end
end

module.RemoveESP = function(part)
    if part:FindFirstChild("esp") and part:FindFirstChild("esp"):IsA("Highlight") then
        part:FindFirstChild("esp"):Destroy()
    end

    for i, obj in pairs(part:GetChildren()) do
        if obj:IsA("BillboardGui") and obj.Name == "esp" then
            obj:Destroy()
        end
        if obj:IsA("TextLabel") and obj.Name == "esp" then
            obj:Destroy()
        end
    end
end

module.Disconnect = function()
    for i, v in pairs(workspace:GetDescendants()) do
        if v.Name == "esp" then
            if v:IsA("Highlight") then
                v:Destroy()
            elseif v:IsA("BillboardGui") then
                v:Destroy()
            elseif v:IsA("TextLabel") then
                v:Destroy()
            end
        end
    end
end

return module
